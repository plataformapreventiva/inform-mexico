---
title: "estados_matrix_creation"
output: html_document
---

```{r setup, include=FALSE}
options(scipen=10000)
source("../utils.R")
```
## TODO 
* Poner cve_ent en sist alertas
* La ingesta de inpc está mal, sólo toma 32 de las 46 ciudades.
* Checar ingesta de jueces

###########################################################################
AMENAZAS
###########################################################################

```{r, results = "hide"}
# INPC
inpc <- large_table(con,raw,inpc_estados) %>% 
  filter(fecha == "2016-9") %>% retrieve_result()

# Sistema de alertas: liquidez y endeudamiento
sistema_alertas <- large_table(con,raw,sistemas_alertas) %>% 
  mutate(endeudamiento = (indicador1+indicador2+indicador3)/3,liquidez = ingresosdelibredisposicion/(pi+pi_2+obligacionesacortoplazoyproveedoresycontratistas)) %>% retrieve_result()

# Join
#amenazas_edo <- left_join(inpc, sistema_alertas, by = "cve_ent")
amenazas_edo <- sistema_alertas
  
# Generación de Reporte
create_reports(amenazas_edo, 
               task_name = "amenazas_edo", 
               output_dir = "../eda/reportes/amenazas")
```

###########################################################################
CAPACIDADES
###########################################################################

```{r, results = "hide"}
# Selección y Construcción de Variables

# Jueces y agentes fiscales por cada cien mil habitantes
jueces <-load_table(con, raw, inegi_jueces) %>% retrieve_result()
agentes_fiscales <-load_table(con, raw, inegi_agentes_fiscales) %>% retrieve_result()

# Join
#capacidades_edo <- left_join(jueces, agentes_fiscales, by="cve_muni")
capacidades_edo <- agentes_fiscales

# Generación de Reporte
create_reports(capacidades_edo, 
               task_name = "capacidades_edo", 
               output_dir = "../eda/reportes/capacidades")
```

###########################################################################
VULNERABILIDADES
###########################################################################

No hay a nivel estado